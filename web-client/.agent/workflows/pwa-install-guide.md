# PWA Install Prompt Implementation

## Краткое описание

Мы реализовали возможность предложения пользователю установить PWA приложение Mesh при переходе со страницы инвайта.

## ⚠️ Важно понимать

**Автоматическая установка PWA невозможна** по соображениям безопасности браузеров. Мы можем:
1. Показать нативный промпт браузера (если доступен)
2. Показать инструкции для ручной установки
3. Пользователь **ДОЛЖЕН** согласиться на установку

## Реализация

### Файлы

1. **`src/pwa/PWAInstallManager.ts`**
   - Менеджер для работы с `beforeinstallprompt` событием
   - Методы для показа нативного промпта
   - Определение платформы и инструкций для ручной установки

2. **`src/pwa/InstallPromptComponent.tsx`**
   - React компонент для отображения UI промпта
   - Показывает либо нативный промпт, либо инструкции
   - Адаптивный дизайн (bottom sheet на мобильных, modal на десктопе)

3. **`src/pwa/InstallPrompt.css`**
   - Стили для компонента промпта
   - Mobile-first подход с адаптацией для десктопа

### Интеграция

#### 1. Invite Page (`communizm-server/static/invite.html`)
```javascript
// Добавлен флаг &showInstall=true к URL веб клиента
// И sessionStorage флаг для запроса показа промпта
```

#### 2. Web Client (`src/App.tsx`)
```typescript
// Проверяет параметр showInstall в URL
// Показывает промпт если:
// - Запрошено через URL или sessionStorage
// - Приложение еще не установлено
// - Промпт не был отклонен в течение последних 7 дней
```

## Как работает

### Сценарий 1: Android Chrome (нативный промпт)
1. Пользователь нажимает "Open in Web Client" на invite.html
2. Перенаправляется на веб клиент с флагом `showInstall=true`
3. После загрузки (через 1 сек) показывается красивый промпт
4. Пользователь нажимает "Install Now"
5. Браузер показывает нативный диалог установки
6. После согласия - приложение устанавливается на домашний экран

### Сценарий 2: iOS Safari (инструкции)
1. Те же шаги 1-3
2. Пользователь видит инструкции специфичные для iOS
3. "Tap Share button, then tap 'Add to Home Screen'"
4. Пользователь следует инструкциям вручную

### Сценарий 3: Desktop Chrome
1. Те же шаги 1-3
2. Пользователь может использовать иконку в адресной строке
3. Или следовать инструкциям в промпте

## Условия показа промпта

Промпт показывается если **ВСЕ** условия выполнены:
- ✅ URL содержит `showInstall=true` или sessionStorage имеет флаг
- ✅ Приложение еще не установлено (не в standalone режиме)
- ✅ Промпт не был отклонен в течение последних 7 дней

## Технические требования PWA

Для работы PWA должны быть:
1. ✅ **manifest.json** - есть в `public/manifest.json`
2. ✅ **Service Worker** - есть в `public/sw.js` и регистрируется
3. ✅ **HTTPS** - уже есть на mesh-online.org
4. ✅ **Icons** - есть в manifest

## Платформы

### Полная поддержка (нативный промпт)
- ✅ Android Chrome/Edge
- ✅ Desktop Chrome/Edge

### Частичная поддержка (только инструкции)
- ⚠️ iOS Safari (ручная установка)
- ⚠️ Firefox (ручная установка)

### Не поддерживается
- ❌ Старые браузеры без поддержки PWA

## Тестирование

### Шаги для тестирования
1. Откройте invite страницу: `https://mesh-online.org/invite/{meshId}`
2. Нажмите "Open in Web Client"
3. Через 1 сек должен появиться промпт установки
4. На Android Chrome - появится кнопка "Install Now"
5. На iOS - появятся инструкции

### Сброс для повторного тестирования
```javascript
// В консоли браузера:
localStorage.removeItem('meshInstallPromptDismissed');
sessionStorage.setItem('meshRequestInstall', 'true');
location.reload();
```

## Что дальше?

Потенциальные улучшения:
1. A/B тестирование разных текстов промпта
2. Аналитика конверсии установок
3. Персонализация промпта на основе платформы
4. Добавление скриншотов в manifest.json
5. Push-уведомления (требует отдельной реализации)
