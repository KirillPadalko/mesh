# –û—Ç—á–µ—Ç –æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Android –∏ Web –∫–ª–∏–µ–Ω—Ç–æ–≤ Mesh

## –î–∞—Ç–∞: 2026-01-05

## Executive Summary

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ web –∫–ª–∏–µ–Ω—Ç–µ –∏ –∏—Ö –≤–ª–∏—è–Ω–∏–µ –Ω–∞ Android –∫–ª–∏–µ–Ω—Ç. –í—ã—è–≤–ª–µ–Ω—ã **3 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è**, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ Android –∫–ª–∏–µ–Ω—Ç–∞. –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.

---

## üî¥ –ö–†–ò–¢–ò–ß–ù–´–ï –†–ê–°–•–û–ñ–î–ï–ù–ò–Ø (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### 1. –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ MeshScore ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Web –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—ã—Ç–∏–π–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è meshScore –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≥—Ä–∞—Ñ–∞
- Android –∫–ª–∏–µ–Ω—Ç –Ω–µ –∏–º–µ–ª —Ç–∞–∫–æ–π —Å–∏—Å—Ç–µ–º—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É UI

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Web –∫–ª–∏–µ–Ω—Ç–µ:**
```typescript
// MeshGraphManager.ts (—Å—Ç—Ä–æ–∫–∏ 115-116)
this.emit('contact-update', { meshId });

// HomeScreen.tsx (—Å—Ç—Ä–æ–∫–∏ 44-47)
meshGraphManager.on('contact-update', () => {
    handleGraphChange();
});
```

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è Android:**

1. **MeshGraphManager.kt** - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–æ–±—ã—Ç–∏–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
```kotlin
interface GraphChangeListener {
    fun onContactUpdate(meshId: String)
    fun onL2Update(via: String, child: String)
}

fun addL1Connection(meshId: String) {
    if (l1Contacts.add(meshId)) {
        saveGraph()
        notifyContactUpdate(meshId)
    }
}
```

2. **MeshViewModel.kt** - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è:
```kotlin
private fun setupGraphListeners() {
    graphManager.addListener(object : MeshGraphManager.GraphChangeListener {
        override fun onContactUpdate(meshId: String) {
            _meshScore.value = graphManager.getMeshScore()
            _l1Items.value = graphManager.getL1Connections()
        }
        override fun onL2Update(via: String, child: String) {
            _meshScore.value = graphManager.getMeshScore()
            _l2Items.value = graphManager.getL2Connections()
        }
    })
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** MeshScore —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ NetworkForegroundService, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—è –ø–æ–≤–µ–¥–µ–Ω–∏—é web –∫–ª–∏–µ–Ω—Ç–∞.

---

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ L2 Notify ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Web –∫–ª–∏–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç L2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- Android –∫–ª–∏–µ–Ω—Ç –∏–º–µ–ª –ø—É—Å—Ç—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `onL2NotifyReceived()`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Web –∫–ª–∏–µ–Ω—Ç–µ:**
```typescript
// HomeScreen.tsx (—Å—Ç—Ä–æ–∫–∏ 33-42)
meshGraphManager.on('l2-update', (data: any) => {
    setNotification(`New L2 Connection discovered via ${data.via}!`);
    notificationManager.notifyL2Connection(viaContact);
});
```

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è Android:**

**NetworkForegroundService.kt:**
```kotlin
override fun onL2NotifyReceived(fromMeshId: String, notifyJson: String) {
    serviceScope.launch {
        val notify = Gson().fromJson(notifyJson, L2Notify::class.java)
        val isValid = inviteManager.processL2Notify(notify)
        if (isValid) {
            val contact = database.contactDao().getContact(fromMeshId)
            val viaContact = contact?.nickname ?: "User ${fromMeshId.take(4)}"
            notificationHelper.showNotification(
                "New L2 Connection", 
                "Discovered via $viaContact"
            )
        }
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** L2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–∞–∫ –≤ web –∫–ª–∏–µ–Ω—Ç–µ.

---

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `MeshGraphManager.kt` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ `MeshViewModel.kt`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `NetworkForegroundService.kt` –¥–ª—è L2 —Å–æ–±—ã—Ç–∏–π

–≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥—Ö–æ–¥—É web –∫–ª–∏–µ–Ω—Ç–∞ —Å `console.debug` –ª–æ–≥–∞–º–∏.

---

## ‚úÖ –°–û–í–ü–ê–î–ï–ù–ò–Ø (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)

### –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è
–û–±–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–∏–¥–µ–Ω—Ç–∏—á–Ω—É—é** –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:
- X25519 ECDH –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏
- HKDF-SHA256 –¥–ª—è –¥–µ—Ä–∏–≤–∞—Ü–∏–∏ –∫–ª—é—á–µ–π —Å–µ—Å—Å–∏–∏
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: salt = 32 –Ω—É–ª–µ–≤—ã—Ö –±–∞–π—Ç–∞, info = "MESH_SESSION_V1"
- AES-GCM —Å 128-–±–∏—Ç–Ω—ã–º —Ç–µ–≥–æ–º –∏ 12-–±–∞–π—Ç–æ–≤—ã–º IV

### –û–±—Ä–∞–±–æ—Ç–∫–∞ Invite/InviteAck
–û–±–∞ –∫–ª–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç:
- –°–æ–∑–¥–∞–Ω–∏–µ invite —Å nickname
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π (—Ñ–æ—Ä–º–∞—Ç: `$from$to$timestamp$nickname`)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ nickname –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- Anti-replay –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ hash tracking

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ MeshGraph
–ò–¥–µ–Ω—Ç–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ:
- L1 –∫–æ–Ω—Ç–∞–∫—Ç—ã (Set<MeshID>)
- L2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Map<L1_MeshID, Set<L2_MeshID>>)
- Processed hashes –¥–ª—è anti-replay
- Received invites –¥–ª—è proof chains

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | Web Client | Android Client | –°—Ç–∞—Ç—É—Å |
|---------|-----------|----------------|--------|
| Mesh Score —Ä–∞—Å—á–µ—Ç | ‚úÖ L1 + 0.3*L2 | ‚úÖ L1 + 0.3*L2 | ‚úÖ –ò–¥–µ–Ω—Ç–∏—á–Ω–æ |
| –†–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI | ‚úÖ –°–æ–±—ã—Ç–∏—è | ‚úÖ –°–æ–±—ã—Ç–∏—è | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| L2 Notify –æ–±—Ä–∞–±–æ—Ç–∫–∞ | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (X25519+HKDF) | ‚úÖ | ‚úÖ | ‚úÖ –ò–¥–µ–Ω—Ç–∏—á–Ω–æ |
| Invite —Å nickname | ‚úÖ | ‚úÖ | ‚úÖ –ò–¥–µ–Ω—Ç–∏—á–Ω–æ |
| Anti-replay (hash tracking) | ‚úÖ | ‚úÖ | ‚úÖ –ò–¥–µ–Ω—Ç–∏—á–Ω–æ |
| –°–∏—Å—Ç–µ–º–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | ‚úÖ | ‚úÖ | ‚úÖ –ò–¥–µ–Ω—Ç–∏—á–Ω–æ |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **Event-Driven Architecture**
   - –í–≤–µ–¥–µ–Ω –ø–∞—Ç—Ç–µ—Ä Observer –¥–ª—è MeshGraphManager
   - ViewModel –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≥—Ä–∞—Ñ–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è UI —Å–æ—Å—Ç–æ—è–Ω–∏—è

2. **Separation of Concerns**
   - NetworkForegroundService —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–µ—Ç–µ–≤—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
   - MeshGraphManager —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≥—Ä–∞—Ñ–∞ –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π
   - ViewModel –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

3. **Thread Safety**
   - –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–æ—Ä—É—Ç–∏–Ω–∞—Ö
   - StateFlow –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

1. **Testing**: –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã MeshGraphManager
2. **Edge Cases**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
3. **Memory**: –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ listeners (—Å–µ–π—á–∞—Å risk –º–∏–Ω–∏–º–∞–ª–µ–Ω)
4. **Consistency**: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏–∫—É —Å web –∫–ª–∏–µ–Ω—Ç–æ–º –ø—Ä–∏ –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã**
‚úÖ **Android –∫–ª–∏–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å web –∫–ª–∏–µ–Ω—Ç–æ–º**
‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞**
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —É—Ö—É–¥—à–µ–Ω–∞**

Android –∫–ª–∏–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π user experience —Å web –∫–ª–∏–µ–Ω—Ç–æ–º, —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º UI –∏ –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π L2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
